===========================================
‚úÖ ENDPOINT CRIADO: Detalhamento de Ap√≥lice
===========================================

üìä NOVO ENDPOINT:
GET /api/apolices/:nrContrato/detalhamento

Executa SQL complexo (1231 linhas) para buscar detalhes de procedimentos, atendimentos e valores de uma ap√≥lice.

===========================================

üîó URL COMPLETA:
https://unhalted-tanja-unvinous.ngrok-free.dev/api/apolices/2444/detalhamento

===========================================

üì• PAR√ÇMETROS:

Path:
  - nrContrato: N√∫mero da ap√≥lice (obrigat√≥rio)

Query (opcionais):
  - dataInicio: DD/MM/YYYY (padr√£o: 01/10/2025)
  - dataFim: DD/MM/YYYY (padr√£o: 31/10/2025)
  - grupoReceita: Nome do grupo (padr√£o: TODAS)
  - limit: Quantidade (padr√£o: 100)
  - offset: Pagina√ß√£o (padr√£o: 0)

===========================================

üì§ EXEMPLO DE RESPOSTA:
{
  "data": [
    {
      "data": "15/10/2025",
      "nm_proced": "Consulta em Cardiologia",
      "beneficiario": "JO√ÉO DA SILVA",
      "prestador": "DR. CARLOS SOUZA",
      "especialidade": "CARDIOLOGIA",
      "gruporeceita": "CONSULTAS ELETIVAS",
      "valor": 150.00,
      "cid_doenca": "I10 - HIPERTENS√ÉO"
    }
  ],
  "pagination": { "total": 156 },
  "filters": {
    "nrContrato": 2444,
    "dataInicio": "01/10/2025",
    "dataFim": "31/10/2025",
    "grupoReceita": "TODAS"
  }
}

===========================================

üíª USAR NO LOVABLE:

1. Abra: PROMPT_LOVABLE_BOTAO_DETALHAMENTO.md
2. Copie TODO o conte√∫do
3. Cole no Lovable
4. O bot√£o "Detalhamento" vai funcionar!

===========================================

üß™ TESTAR AGORA:

Navegador:
https://unhalted-tanja-unvinous.ngrok-free.dev/api/apolices/2444/detalhamento?dataInicio=01/10/2025&dataFim=31/10/2025

cURL:
curl "https://unhalted-tanja-unvinous.ngrok-free.dev/api/apolices/2444/detalhamento?dataInicio=01/10/2025&dataFim=31/10/2025" -H "ngrok-skip-browser-warning: true"

===========================================

üìÅ ARQUIVOS CRIADOS:

‚úì server/queries/detalhamento-apolice.ts - M√≥dulo de query
‚úì server/sql/detalhamento-apolice-completo.sql - SQL completo
‚úì server/routes.ts - Endpoint adicionado
‚úì shared/schema.ts - Valida√ß√£o Zod
‚úì API_DETALHAMENTO_APOLICE.md - Documenta√ß√£o completa
‚úì PROMPT_LOVABLE_BOTAO_DETALHAMENTO.md - Prompt para Lovable
‚úì RESUMO_DETALHAMENTO_APOLICE.txt - Este arquivo

===========================================

‚úÖ O QUE FOI FEITO:

1. ‚úÖ SQL parametrizado com bind variables (seguro)
2. ‚úÖ Arquitetura em camadas (routes ‚Üí queries ‚Üí db)
3. ‚úÖ Valida√ß√£o com Zod
4. ‚úÖ Pagina√ß√£o suportada
5. ‚úÖ Filtro por grupo de receita
6. ‚úÖ CORS configurado
7. ‚úÖ Documenta√ß√£o completa
8. ‚úÖ Prompt pronto para Lovable
9. ‚úÖ Cache do SQL na inicializa√ß√£o

===========================================

üéØ PR√ìXIMO PASSO:

1. Abrir: PROMPT_LOVABLE_BOTAO_DETALHAMENTO.md
2. Copiar todo o conte√∫do
3. Colar no Lovable
4. Escolher entre:
   a) Modal de detalhamento (mais r√°pido)
   b) Nova p√°gina de detalhamento (mais espa√ßo)

===========================================

‚ö†Ô∏è LEMBRE-SE:

- Header obrigat√≥rio: 'ngrok-skip-browser-warning': 'true'
- URL do Ngrok muda quando reinicia
- Formato de data: DD/MM/YYYY
- N√∫mero da ap√≥lice: vem da linha da tabela clicada

===========================================

üèóÔ∏è ARQUITETURA LIMPA:

routes.ts (Controller)
    ‚Üì valida par√¢metros
queries/detalhamento-apolice.ts (Service)
    ‚Üì carrega SQL e parametriza
oracle-db.ts (Data Access)
    ‚Üì executa query
Oracle Database
    ‚Üì retorna dados
JSON Response

SQL carregado 1x na inicializa√ß√£o (performance!)

===========================================

üìä PRINCIPAIS CAMPOS:

- data, hora, dataalta
- tipo_conta, atendimento
- nm_proced, tiposervico, gruporeceita
- beneficiario, titular, tipodependente
- prestador, especialidade
- valor, valortotal, qtde
- cid_doenca
- vl_procedimento_coparticipacao

===========================================
